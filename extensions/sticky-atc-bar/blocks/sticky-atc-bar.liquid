<div
  id="bdm-sticky-atc"
  class="bdm-sticky-atc"
  aria-hidden="true"
  data-shop="{{ shop.permanent_domain }}"

  {% if block.settings.show_on_desktop %}data-enable-desktop{% endif %}
  {% if block.settings.show_on_mobile %}data-enable-mobile{% endif %}
  {% if block.settings.show_only_after_scroll %}data-show-on-scroll{% endif %}
  data-scroll-offset="{{ block.settings.scroll_offset | default: 250 }}"

  {% if block.settings.show_product_title %}data-show-title{% endif %}
  {% if block.settings.show_price %}data-show-price{% endif %}
  {% if block.settings.show_quantity_selector %}data-show-qty{% endif %}

  style="
    --bdm-bg: {{ block.settings.bar_background_color }};
    --bdm-text: {{ block.settings.text_color }};
    --bdm-font-size: {{ block.settings.font_size }}px;
    --bdm-shadow: {% if block.settings.enable_shadow %}0 -2px 10px rgba(0,0,0,.12){% else %}none{% endif %};
    --bdm-button-bg: {{ block.settings.button_background_color }};
    --bdm-button-text: {{ block.settings.button_text_color }};
    --bdm-button-radius: {{ block.settings.button_radius }}px;
  "
>
  <div class="bdm-inner">
    <div class="bdm-left">
      <div id="bdm-title" style="display:none"></div>
      <div id="bdm-price" style="display:none"></div>
    </div>

    <div class="bdm-right">
      <div class="bdm-qty" style="display:none">
        <button
          type="button"
          class="bdm-qty-btn"
          data-action="decrease"
          aria-label="Decrease quantity"
        >−</button>

        <input
          id="bdm-qty"
          type="number"
          min="1"
          value="1"
          inputmode="numeric"
        />

        <button
          type="button"
          class="bdm-qty-btn"
          data-action="increase"
          aria-label="Increase quantity"
        >+</button>
      </div>

      <button
        id="bdm-atc"
        class="bdm-button bdm-button--{{ block.settings.button_style | downcase }}"
        type="button"
      >
        {{ block.settings.button_text }}
      </button>
    </div>
  </div>
</div>

{%- comment -%}
  ✅ Guarantee the shop domain exists for tracking scripts,
  even when Shopify.shop is undefined in some themes.
{%- endcomment -%}
<script>
  window.__SHOP_DOMAIN__ = {{ shop.permanent_domain | json }};
</script>

{{ 'sticky-atc-bar.css' | asset_url | stylesheet_tag }}
{{ 'sticky-atc-bar.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Sticky Add To Cart Bar",
  "app_embed": true,
  "target": "body",
  "settings": [
    { "type": "checkbox", "id": "show_on_desktop", "label": "Show on desktop", "default": true },
    { "type": "checkbox", "id": "show_on_mobile", "label": "Show on mobile", "default": true },
    { "type": "checkbox", "id": "show_only_after_scroll", "label": "Show only after scrolling", "default": false },
    { "type": "range", "id": "scroll_offset", "label": "Scroll offset (px)", "min": 0, "max": 1000, "step": 10, "default": 250 },

    { "type": "checkbox", "id": "show_product_title", "label": "Show product title", "default": true },
    { "type": "checkbox", "id": "show_price", "label": "Show price", "default": true },
    { "type": "checkbox", "id": "show_quantity_selector", "label": "Show quantity selector", "default": true },

    { "type": "color", "id": "bar_background_color", "label": "Bar background color", "default": "#FAFAF9" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#000000" },
    { "type": "range", "id": "font_size", "label": "Font size (px)", "min": 12, "max": 20, "step": 1, "default": 14 },
    { "type": "checkbox", "id": "enable_shadow", "label": "Enable shadow", "default": true },

    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "options": [
        { "value": "solid", "label": "Solid" },
        { "value": "outline", "label": "Outline" }
      ],
      "default": "solid"
    },

    { "type": "range", "id": "button_radius", "label": "Button radius (px)", "min": 0, "max": 30, "step": 1, "default": 12 },
    { "type": "color", "id": "button_background_color", "label": "Button background color", "default": "#111111" },
    { "type": "color", "id": "button_text_color", "label": "Button text color", "default": "#FFFFFF" },
    { "type": "text", "id": "button_text", "label": "Button text", "default": "Add to cart" }
  ]
}
{% endschema %}

