(function(){function u(e,t={}){const i=Shopify?.shop;try{const r=i?`/apps/bdm-sticky-atc/track?shop=${encodeURIComponent(i)}`:"/apps/bdm-sticky-atc/track";fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e,productId:window.ShopifyAnalytics?.meta?.product?.id,timestamp:Date.now(),...t})})}catch(e){}}u("page_view");async function m(){let e=!1;try{const t=(window.Shopify&&Shopify.routes&&Shopify.routes.root)||"/",i=await fetch(`${t}?sections=cart-drawer,cart-icon-bubble`);let r=null;try{r=await i.json()}catch{}if(r){const d={id:Date.now(),sections:r},o=document.querySelector("cart-drawer");if(o&&typeof o.renderContents=="function"&&r["cart-drawer"]){o.renderContents(d);try{const s=await fetch("/cart.js").then(a=>a.json());o.classList.toggle("is-empty",s.item_count===0)}catch{}e=!0}const n=document.getElementById("cart-icon-bubble");if(n&&r["cart-icon-bubble"]){const s=document.createElement("div");s.innerHTML=r["cart-icon-bubble"];const a=s.querySelector("#cart-icon-bubble");a&&n.replaceWith(a);e=!0}}}catch{}try{const t=await fetch("/cart.js").then(i=>i.json()),r=t.item_count;document.querySelectorAll(".cart-count, .cart-count-bubble, [data-cart-count]").forEach(i=>{i.textContent=r;i.dataset.cartCount=r;r>0?(i.removeAttribute("hidden"),i.classList.remove("is-empty"),i.setAttribute("aria-hidden","false")):(i.classList.add("is-empty"),i.setAttribute("aria-hidden","true"))});document.dispatchEvent(new CustomEvent("cart:refresh",{detail:{cart:t}}));document.dispatchEvent(new CustomEvent("cartcount:update",{detail:{count:r}}));document.dispatchEvent(new CustomEvent("ajaxProduct:added",{detail:{cart:t}}));typeof window.fetchCart=="function"&&window.fetchCart();typeof window.updateCart=="function"&&window.updateCart();typeof window.refreshCart=="function"&&window.refreshCart()}catch{}try{const t=document.querySelector('[data-cart-toggle]')||document.querySelector('[data-drawer-toggle]')||document.querySelector(".js-cart-toggle")||document.querySelector(".js-drawer-open-cart")||document.querySelector('[aria-controls="CartDrawer"]')||document.querySelector("#cart-icon-bubble");t&&t.dispatchEvent(new Event("click",{bubbles:!0,cancelable:!0}))}catch{}}function g(){const e=document.getElementById("bdm-sticky-atc-bar-root");if(!e)return;const t=document.querySelector('form[action*="/cart/add"]');if(!t)return;const i=window.matchMedia("(max-width: 768px)").matches,r=e.dataset.productTitle||document.title,c=window.ShopifyAnalytics?.meta?.product?.variants||[],d=c.length>1,o=t.querySelector("select[name='id']");let n=o?o.value:c[0]?.id;if(!n){const a=t.querySelector("[name='id']");a&&(n=a.value)}const s=a=>c.find(l=>String(l.id)===String(a)),f=a=>(typeof a=="number"?a:0)/100..toLocaleString(void 0,{style:"currency",currency:Shopify?.currency?.active||"USD"});let p=s(n)?.price,b=document.createElement("div");b.className="bdm-sticky-atc-bar-container";const y=document.createElement("div");y.className="bdm-sticky-atc-bar-inner";const h=document.createElement("div");h.className="bdm-sticky-atc-product";const k=document.createElement("div");k.className="bdm-sticky-atc-title";k.textContent=r;const v=document.createElement("div");v.className="bdm-sticky-atc-price";v.textContent=f(p);h.appendChild(k);h.appendChild(v);const C=document.createElement("div");C.className="bdm-sticky-atc-variant";if(d){const a=document.createElement("select");a.className="bdm-sticky-atc-variant-select";c.forEach(l=>{const w=document.createElement("option");w.value=l.id;w.textContent=l.public_title||l.title||`Variant ${l.id}`;a.appendChild(w)});a.value=n;a.addEventListener("change",()=>{n=a.value;const l=s(n);l&&(p=l.price,v.textContent=f(p));u("variant_change",{variantId:n});o&&(o.value=n,o.dispatchEvent(new Event("change",{bubbles:!0})))});if(i){k.style.display="none";const l=document.createElement("div");l.className="bdm-variant-mobile-row";l.appendChild(a);h.insertBefore(l,v)}else C.appendChild(a)}const S=document.createElement("div");S.className="bdm-sticky-atc-qty";const E=document.createElement("button");E.className="bdm-qty-btn";E.textContent="âˆ’";const B=document.createElement("input");B.className="bdm-qty-input";B.type="number";B.min="1";B.value="1";const T=document.createElement("button");T.className="bdm-qty-btn";T.textContent="+";E.addEventListener("click",()=>{B.value=Math.max(1,Number(B.value)-1)});T.addEventListener("click",()=>{B.value=Number(B.value)+1});S.append(E,B,T);const I=document.createElement("button");I.className="bdm-sticky-atc-button";I.textContent="Add to cart";I.addEventListener("click",async()=>{if(!n){const a=t.querySelector("[name='id']");a&&(n=a.value)}if(!n)return alert("Unable to determine variant.");const a=Math.max(1,Number(B.value)||1);sessionStorage.setItem("bdm_sticky_atc_last_event",JSON.stringify({product:window.ShopifyAnalytics?.meta?.product?.id,variant:n,time:Date.now()}));u("add_to_cart",{variantId:n,quantity:a,price:p});const l=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:n,quantity:a})});if(!l.ok)return console.error("Cart add error",await l.text()),alert("Could not add to cart. Please try again.");sessionStorage.setItem("bdm_sticky_last_atc",Date.now());sessionStorage.setItem("bdm_sticky_variant",n);sessionStorage.setItem("bdm_sticky_product",window.ShopifyAnalytics?.meta?.product?.id);m()});const O=document.createElement("div");O.className="bdm-sticky-atc-controls";!i&&d?O.append(C,S,I):O.append(S,I);y.append(h,O);b.appendChild(y);document.body.appendChild(b)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g();})();
